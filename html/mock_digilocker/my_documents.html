<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title data-i18n="dl_mydoc_title">My Documents | DigiLocker Demo</title>
  <link rel="stylesheet" href="../../css/style.css" />
  <link rel="stylesheet" href="../../css/digilocker.css" />
  <script src="../../js/i18n.js" defer></script>
  <link rel="icon" href="../../images/india.png" type="image/png" />
</head>
<body>

  <!-- Top Bar -->
  <div class="top-bar">
    <div class="top-right">
      <select id="languageSelect" aria-label="Select Language">
        <option value="en">English</option>
        <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
        <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
        <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
        <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
        <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
        <option value="gu">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</option>
        <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
        <option value="ml">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</option>
        <option value="pa">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä</option>
        <option value="or">‡¨ì‡¨°‡¨º‡¨ø‡¨Ü</option>
        <option value="ur">ÿßÿ±ÿØŸà</option>
      </select>
      <a href="../../html/login.html" class="login-btn" data-i18n="login">Login</a>
    </div>
  </div>

  <!-- Header -->
  <header class="gov-header full-width-header">
    <div class="header-left">
      <img src="../../images/logo.png" alt="Digital India Access Logo" class="site-logo pulse-animation" />
    </div>
    <div class="header-title">
      <h1 data-i18n="title">Digital India Access Training</h1>
      <p data-i18n="mission">Digital India Mission</p>
    </div>
  </header>

  <!-- Navigation -->
  <nav class="main-nav">
    <a href="../../html/home.html" data-i18n="nav_home">Home</a>
    <a href="../../html/courses.html" data-i18n="nav_courses">Courses</a>
    <a href="../../html/quiz.html" data-i18n="nav_quiz">Quiz</a>
    <a href="../../html/certificate.html" data-i18n="nav_certificate">Certificate</a>
    <a href="../../html/dashboard.html" class="active" data-i18n="nav_dashboard">Dashboard</a>
  </nav>

  <!-- Content -->
  <main class="digilocker-dashboard">
    <h2 class="section-title" data-i18n="dl_mydoc_heading">My Documents</h2>
    <div id="documentsList" class="dashboard-grid"></div>
  </main>

  <script>
    function getDigiHeaders() {
      return {
        'Authorization': `Bearer ${localStorage.getItem('digilocker_token')}`,
        'Content-Type': 'application/json'
      };
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const container = document.getElementById('documentsList');
      const token = localStorage.getItem('digilocker_token');

      if (!token) {
        container.innerHTML = '<p>‚ö†Ô∏è Invalid or expired token.</p>';
        return;
      }

      try {
        const res = await fetch('http://localhost:3001/api/digilocker/documents', {
          headers: getDigiHeaders()
        });

        const data = await res.json();

        if (res.ok && Array.isArray(data.documents)) {
          if (data.documents.length === 0) {
            container.innerHTML = '<p>No documents found.</p>';
            return;
          }

          container.innerHTML = '';
          data.documents.forEach(doc => {
            const card = document.createElement('div');
            card.className = 'dashboard-card';
            card.innerHTML = `
              <h3>${doc.name}</h3>
              <p><strong>Type:</strong> ${doc.type}</p>
              <p><strong>Issued By:</strong> ${doc.issuedBy}</p>
              <p><strong>Issued On:</strong> ${doc.issueDate}</p>
              <a href="${doc.fileUrl}" target="_blank">üìÑ View / Download</a>
            `;
            container.appendChild(card);
          });
        } else {
          container.innerHTML = `<p>‚ö†Ô∏è ${data.message || 'Error loading documents'}</p>`;
        }

      } catch (err) {
        console.error('Fetch error:', err);
        container.innerHTML = '<p>‚ö†Ô∏è Failed to fetch documents.</p>';
      }
    });
  </script>
</body>
</html>
