<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title data-i18n="quiz_title1">Quiz | DigiLocker Basics</title>
  <link rel="stylesheet" href="../../css/style.css" />
  <script src="../../js/i18n.js" defer></script>
  <link rel="icon" href="../../images/india.png" type="image/png" />
</head>
<body>
  <div class="top-bar">
    <div class="top-right">
      <select id="languageSelect" aria-label="Select Language">
        <!-- language options -->
        <option value="en">English</option>
        <option value="hi">हिंदी</option>
        <option value="bn">বাংলা</option>
        <option value="te">తెలుగు</option>
        <option value="mr">मराठी</option>
        <option value="ta">தமிழ்</option>
        <option value="gu">ગુજરાતી</option>
        <option value="kn">ಕನ್ನಡ</option>
        <option value="ml">മലയാളം</option>
        <option value="pa">ਪੰਜਾਬੀ</option>
        <option value="or">ଓଡ଼ିଆ</option>
        <option value="ur">اردو</option>
      </select>
      <a href="../login.html" class="login-btn" data-i18n="login">Login</a>
    </div>
  </div>

  <header class="gov-header full-width-header">
    <div class="header-left">
      <img src="../../images/logo.png" alt="Digital India Access Logo" class="site-logo pulse-animation" />
    </div>
    <div class="header-title">
      <h1 data-i18n="title">Digital India Access Training</h1>
      <p data-i18n="mission">Digital India Mission</p>
    </div>
  </header>

  <nav class="main-nav">
    <a href="../home.html" data-i18n="nav_home">Home</a>
    <a href="../courses.html" data-i18n="nav_courses">Courses</a>
    <a href="../quiz.html" class="active" data-i18n="nav_quiz">Quiz</a>
    <a href="../certificate.html" data-i18n="nav_certificate">Certificate</a>
    <a href="../dashboard.html" data-i18n="nav_dashboard">Dashboard</a>
  </nav>

  <main class="quiz-box">
    <h2 class="quiz-title" data-i18n="quiz_heading">DigiLocker Basics Quiz</h2>
    <form id="quizForm" class="quiz-form">
      <div class="quiz-question">
        <p><span data-i18n="dlq1">1. What is DigiLocker used for?</span></p>
        <div class="quiz-options">
          <label><input type="radio" name="q1" value="a" /> <span data-i18n="dlq1a">Paying bills</span></label>
          <label><input type="radio" name="q1" value="b" /> <span data-i18n="dlq1b">Storing digital documents</span></label>
          <label><input type="radio" name="q1" value="c" /> <span data-i18n="dlq1c">Watching videos</span></label>
          <label><input type="radio" name="q1" value="d" /> <span data-i18n="dlq1d">Sending money</span></label>
        </div>
      </div>

<div class="quiz-question">
  <p><span data-i18n="dlq2">2. Which of the following documents can be stored in DigiLocker?</span></p>
  <div class="quiz-options">
    <label><input type="radio" name="q2" value="a" /> <span data-i18n="dlq2a">Driving License</span></label>
    <label><input type="radio" name="q2" value="b" /> <span data-i18n="dlq2b">PAN Card</span></label>
    <label><input type="radio" name="q2" value="c" /> <span data-i18n="dlq2c">Aadhaar Card</span></label>
    <label><input type="radio" name="q2" value="d" /> <span data-i18n="dlq2d">All of the above</span></label>
  </div>
</div>

<div class="quiz-question">
  <p><span data-i18n="dlq3">3. Is DigiLocker a government initiative?</span></p>
  <div class="quiz-options">
    <label><input type="radio" name="q3" value="a" /> <span data-i18n="dlq3a">Yes</span></label>
    <label><input type="radio" name="q3" value="b" /> <span data-i18n="dlq3b">No</span></label>
    <label><input type="radio" name="q3" value="c" /> <span data-i18n="dlq3c">Private</span></label>
    <label><input type="radio" name="q3" value="d" /> <span data-i18n="dlq3d">NGO</span></label>
  </div>
</div>

<div class="quiz-question">
  <p><span data-i18n="dlq4">4. Can DigiLocker documents be used at the airport?</span></p>
  <div class="quiz-options">
    <label><input type="radio" name="q4" value="a" /> <span data-i18n="dlq4a">No</span></label>
    <label><input type="radio" name="q4" value="b" /> <span data-i18n="dlq4b">Only with a fee</span></label>
    <label><input type="radio" name="q4" value="c" /> <span data-i18n="dlq4c">Yes</span></label>
    <label><input type="radio" name="q4" value="d" /> <span data-i18n="dlq4d">Not sure</span></label>
  </div>
</div>

<div class="quiz-question">
  <p><span data-i18n="dlq5">5. Who can create a DigiLocker account?</span></p>
  <div class="quiz-options">
    <label><input type="radio" name="q5" value="a" /> <span data-i18n="dlq5a">Only students</span></label>
    <label><input type="radio" name="q5" value="b" /> <span data-i18n="dlq5b">Anyone with Aadhaar</span></label>
    <label><input type="radio" name="q5" value="c" /> <span data-i18n="dlq5c">Only government employees</span></label>
    <label><input type="radio" name="q5" value="d" /> <span data-i18n="dlq5d">Only aged above 60</span></label>
  </div>
</div>

<div class="quiz-question">
  <p><span data-i18n="dlq6">6. DigiLocker reduces the need for?</span></p>
  <div class="quiz-options">
    <label><input type="radio" name="q6" value="a" /> <span data-i18n="dlq6a">Mobile phones</span></label>
    <label><input type="radio" name="q6" value="b" /> <span data-i18n="dlq6b">Internet</span></label>
    <label><input type="radio" name="q6" value="c" /> <span data-i18n="dlq6c">Carrying physical documents</span></label>
    <label><input type="radio" name="q6" value="d" /> <span data-i18n="dlq6d">Electricity</span></label>
  </div>
</div>

<div class="quiz-question">
  <p><span data-i18n="dlq7">7. DigiLocker is secured using?</span></p>
  <div class="quiz-options">
    <label><input type="radio" name="q7" value="a" /> <span data-i18n="dlq7a">OTP and Aadhaar</span></label>
    <label><input type="radio" name="q7" value="b" /> <span data-i18n="dlq7b">Fingerprint only</span></label>
    <label><input type="radio" name="q7" value="c" /> <span data-i18n="dlq7c">Password only</span></label>
    <label><input type="radio" name="q7" value="d" /> <span data-i18n="dlq7d">None</span></label>
  </div>
</div>

<div class="quiz-question">
  <p><span data-i18n="dlq8">8. Which ministry maintains DigiLocker?</span></p>
  <div class="quiz-options">
    <label><input type="radio" name="q8" value="a" /> <span data-i18n="dlq8a">Ministry of Education</span></label>
    <label><input type="radio" name="q8" value="b" /> <span data-i18n="dlq8b">Ministry of Environment</span></label>
    <label><input type="radio" name="q8" value="c" /> <span data-i18n="dlq8c">Ministry of Electronics and IT</span></label>
    <label><input type="radio" name="q8" value="d" /> <span data-i18n="dlq8d">Ministry of Finance</span></label>
  </div>
</div>

<div class="quiz-question">
  <p><span data-i18n="dlq9">9. Can you share documents from DigiLocker?</span></p>
  <div class="quiz-options">
    <label><input type="radio" name="q9" value="a" /> <span data-i18n="dlq9a">No</span></label>
    <label><input type="radio" name="q9" value="b" /> <span data-i18n="dlq9b">Yes</span></label>
    <label><input type="radio" name="q9" value="c" /> <span data-i18n="dlq9c">Only via mail</span></label>
    <label><input type="radio" name="q9" value="d" /> <span data-i18n="dlq9d">Only at CSC centers</span></label>
  </div>
</div>

<div class="quiz-question">
  <p><span data-i18n="dlq10">10. What is required to sign up for DigiLocker?</span></p>
  <div class="quiz-options">
    <label><input type="radio" name="q10" value="a" /> <span data-i18n="dlq10a">Voter ID</span></label>
    <label><input type="radio" name="q10" value="b" /> <span data-i18n="dlq10b">PAN</span></label>
    <label><input type="radio" name="q10" value="c" /> <span data-i18n="dlq10c">Aadhaar Number</span></label>
    <label><input type="radio" name="q10" value="d" /> <span data-i18n="dlq10d">Passport</span></label>
  </div>
</div>

<button type="submit" class="cta-btn" data-i18n="submit_quiz">Submit Quiz</button>
 </form>

    <div id="quizResult" class="quiz-result"></div>
  </main>

<script>
function getAuthHeaders() {
  return {
    'Authorization': `Bearer ${localStorage.getItem('token')}`,
    'Content-Type': 'application/json'
  };
}

document.getElementById('quizForm').addEventListener('submit', async function(e) {
  e.preventDefault();

  const correctAnswers = {
    q1: 'b', q2: 'd', q3: 'a', q4: 'c', q5: 'b',
    q6: 'c', q7: 'a', q8: 'c', q9: 'b', q10: 'c'
  };

  const allKeys = Object.keys(correctAnswers);
  const answersArray = [];
  let score = 0;

  allKeys.forEach((qKey) => {
    const selected = document.querySelector(`input[name="${qKey}"]:checked`);
    const selectedValue = selected ? selected.value : null;
    answersArray.push(selectedValue !== null ? ['a', 'b', 'c', 'd'].indexOf(selectedValue) : -1);

    if (selectedValue === correctAnswers[qKey]) score++;
  });

  const passing = Math.ceil(allKeys.length * 0.7);
  const result = document.getElementById('quizResult');

  try {
    // ✅ Submit quiz answers
    const quizRes = await fetch('http://localhost:3001/api/quiz/submit', {
      method: 'POST',
      headers: getAuthHeaders(),
      body: JSON.stringify({
        module: 'digilocker',
        answers: answersArray
      })
    });

    const quizData = await quizRes.json();

    if (!quizRes.ok) {
      throw new Error(quizData.message || 'Quiz submission failed');
    }

    // ✅ If passed, mark module as completed
    if (score >= passing) {
      const completeRes = await fetch('http://localhost:3001/api/user/complete', {
        method: 'POST',
        headers: getAuthHeaders(),
        body: JSON.stringify({ moduleName: 'digilocker' })
      });

      const completeData = await completeRes.json();

      if (!completeRes.ok) {
        throw new Error(completeData.message || 'Failed to mark module complete');
      }

      result.innerHTML = `✅ You passed! Score: ${score}/${allKeys.length}<br>
        <a href='../certificate.html?module=digilocker' class='cta-btn'>Download Certificate</a>`;
    } else {
      result.innerHTML = `❌ You did not pass. Score: ${score}/${allKeys.length}`;
    }

  } catch (err) {
    console.error('Error submitting quiz:', err);
    result.innerHTML = '⚠️ Error submitting quiz. Try again.';
  }

  result.scrollIntoView({ behavior: "smooth" });
});
</script>
</body>
</html>